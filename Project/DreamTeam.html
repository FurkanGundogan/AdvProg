<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <meta name="author" content="Furkan Gundogan, Istanbul, 2020">
  <link rel="icon" href="https://furkangundogan.github.io/AdvProg/images/iconproject.png" sizes="192x192">
  <title>DreamTeam</title>


  <style>


  </style>
</head>


<link rel="stylesheet" href="drmteam.css">

<body>
  <div class="ProjectTitle">Make Your Dream Team</div>
  <div class="top">
    <div class="top-contents1">
      <div class="filters">
        <span class="filter-title">Position</span>
        <div class="dropdown dropdown-dark">
          <select id="optPos" name="position" class="dropdown-select" onchange="filterplayers()">
            <option>ALL</option>
            <option>FV</option>
            <option>MID</option>
            <option>DEF</option>
            <option>GK</option>
          </select>
        </div>
      </div>
      <div class="filters">
        <span class="filter-title">Nation</span>
        <div class="dropdown dropdown-dark">
          <select id="optNat" name="nation" class="dropdown-select" onchange="filterplayers()">
            <option>ALL</option>
            <option>ARG</option>
            <option>BRA</option>
            <option>CRO</option>
            <option>ENG</option>
            <option>ESP</option>
            <option>POR</option>
            <option>GER</option>
            <option>TUR</option>

          </select>
        </div>
      </div>
      <div class="filters">
        <span class="filter-title">Max Age</span>
        <div class="dropdown dropdown-dark">
          <select id="optAge" name="nation" class="dropdown-select" onchange="filterplayers()">
            <option>ALL</option>
            <option>35</option>
            <option>30</option>
            <option>25</option>
            <option>20</option>
          </select>
        </div>
      </div>
    </div>

    <div class="top-contents2">
      <div class="filters">
        <span class="filter-title">Name</span>
        <input class="inputs" id="inpName" type="text" placeholder="Name" onchange="filterplayers()">
      </div>

      <div class="filters">
        <span class="filter-title">Club</span>
        <input class="inputs" id="inpClub" type="text" placeholder="Club" onchange="filterplayers()">

      </div>

      <div class="filters">

        <button id="btn2" class=" buttons inputs" onclick="filterplayers()">Find Players</button>
      </div>


    </div>

  </div>
  <div class="tableTop">
  <div class="ttleft"><span id="hideshow" onclick="tabletoggle()">Hide Table</span></div>
  <div class="ttright"><span id="showCount">Showing 3 of All </span></div>
  </div>
  <div class="mytable">
    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">NAME</th>
          <th scope="col">RATING</th>
          <th scope="col">POS</th>
          <th scope="col">NATION</th>
          <th scope="col">AGE</th>
          <th scope="col">CLUB</th>
          <th scope="col"> </th>

        </tr>
      </thead>
      <tbody id="tableContents">
     <!-- samples   <tr>
          <th scope="row">0</th>
          <td>LEO MESSI</td>
          <td>94</td>
          <td>FV</td>
          <td>ARG</td>
          <td>33</td>
          <td>BARCELONA</td>
          <td><button onclick='addplayer("0")'>+</button></td>

        </tr>
        <tr>
          <th scope="row">1</th>
          <td>CRISTIANO RONALDO</td>
          <td>94</td>
          <td>FV</td>
          <td>POR</td>
          <td>34</td>
          <td>JUVENTUS</td>
          <td><button onclick='addplayer("1")'>+</button></td>
        </tr>
        <tr>
          <th scope="row">2</th>
          <td>ROBERT LEWANDOWSKI</td>
          <td>94</td>
          <td>FV</td>
          <td>POL</td>
          <td>32</td>
          <td>BAYERN MUNCHEN</td>
          <td><button onclick='addplayer("2")'>+</button></td>
        </tr>
         --> 

      </tbody>
    </table>
  </div>
  <div class="bottompart">
    <div class="bottomLeft">
      <div class="filters">
        <span class="filter-title">Formation</span>
        <div class="dropdown dropdown-dark">
          <select id="optFor" name="nation" class="dropdown-select" onchange="formEdit()">
            <option>4-4-2</option>
            <option>4-3-3</option>
            <option>4-5-1</option> 
            <option>5-4-1</option>
            <option>3-4-3</option>
            <option>3-5-2</option>
          </select>
        </div>       
      </div>
      <div class="ovrAndChe">
        <div class="ovrchemtitle"><p>Overall & Chemistry</p></div>
        <div class="circularvalue"><p id="ovr">0</p>
          <p id="midspace"></p>
        <p id="chem">0</p></div>
      </div>
      <div class="saha">
        <img src="https://furkangundogan.github.io/dataforproject/datafile/formations/4-4-2.png" id ="forimg" class="formation">
      </div>
      <span class="author">Made by Furkan Gundogan</span>
    </div>

    <div class="bottomRight">
      <div>
        <p id="teamMes">Team
      </p>
      </div>
      <div id="topDiv">
        
        <div id="p0" class="pl">
          <p class="plp" id="pos0">GK</p>
          <p class="plp namep" id="name0"></p>
          <p class="delp" onclick='deletePlayer("name0")'>X</p>
        </div>
        <div id="p1" class="pl">
          <p class="plp" id="pos1">DEF</p>
          <p class="plp namep" id="name1"></p>
          <p class="delp"onclick='deletePlayer("name1")'>X</p>
        </div>
        <div id="p2" class="pl">
          <p class="plp" id="pos2">DEF</p>
          <p class="plp namep" id="name2"></p>
          <p class="delp"onclick='deletePlayer("name2")' >X</p>
        </div>
        <div id="p3" class="pl">
          <p class="plp" id="pos3">DEF</p>
          <p class="plp namep" id="name3"></p>
          <p class="delp"onclick='deletePlayer("name3")'>X</p>
        </div>
        <div id="p4" class="pl">
          <p class="plp" id="pos4">DEF</p>
          <p class="plp namep" id="name4"></p>
          <p class="delp" onclick='deletePlayer("name4")'>X</p>
        </div>
        <div id="p5" class="pl">
          <p class="plp" id="pos5">MID</p>
          <p class="plp namep" id="name5"></p>
          <p class="delp" onclick='deletePlayer("name5")'>X</p>
        </div>
        <div id="p6" class="pl">
          <p class="plp" id="pos6">MID</p>
          <p class="plp namep" id="name6"></p>
          <p class="delp" onclick='deletePlayer("name6")'>X</p>
        </div>
        <div id="p7" class="pl">
          <p class="plp" id="pos7">MID</p>
          <p class="plp namep" id="name7"></p>
          <p class="delp" onclick='deletePlayer("name7")'>X</p>
        </div>
        <div id="p8" class="pl">
          <p class="plp" id="pos8">MID</p>
          <p class="plp namep" id="name8"></p>
          <p class="delp" onclick='deletePlayer("name8")'>X</p>
        </div>
        <div id="p9" class="pl">
          <p class="plp" id="pos9">FV</p>
          <p class="plp namep" id="name9"></p>
          <p class="delp" onclick='deletePlayer("name9")'>X</p>
        </div>
        <div id="p10" class="pl">
          <p class="plp" id="pos10">FV</p>
          <p class="plp namep" id="name10"></p>
          <p class="delp" onclick='deletePlayer("name10")'>X</p>
        </div>


      </div>
    </div>
    </div>
    
</body>

<script>
  "use strict";
  setmargintop();
  let playersOnTable = [];
  let playersOnTeam = [];
  class Player {
    constructor(id, name, pos, rat, nat, age, club) {
      this.id = id;
      this.name = name;
      this.rat = rat;
      this.pos = pos;
      this.nat = nat;
      this.age = age;
      this.club = club;
    }
    toString() {
      return this.id + " " + this.name + " " + this.pos + " " + this.nat + " " + this.rat + " " + this.age + " " + this.club;
    }
    static fromString(s) {
      return new Player(...s.split('\t'))
    }
  }
  let playerMap = new Map(); 
  function makeData(txt, Maker, map) {
    map.clear()
    for (let line of txt.split('\n')) {
      if (!line) continue
      let p = Maker.fromString(line)
      map.set(p.id, p)
    }

    return map;
  }
  const LINK = "https://furkangundogan.github.io/dataforproject/datafile/"

  function getPlayers() {
    fetch(LINK + "players.txt").then(r => r.text())
      .then(x => makeData(x, Player, playerMap))
      giveColortoPos();
  }
  function filterplayers() {
    playersOnTable = [];
    playerMap.forEach(p => {

      if (natControl(getE("optNat").value, p) &&
        posControl(getE("optPos").value, p) &&
        ageControl(getE("optAge").value, p) &&
        clubControl(getE("inpClub").value, p) &&
        nameControl(getE("inpName").value, p)) {
        playersOnTable.push(p);
      }
    });

    fillTable();
  }
  function getE(element) {
    return document.getElementById(element)
  }
  function natControl(optValue, player) {
    if (optValue == "ALL") return true
    if (optValue == player.nat) return true
    else return false
  }
  function posControl(posValue, player) {
    if (posValue == "ALL") return true
    if (posValue == player.pos) return true
    else return false
  }
  function ageControl(ageValue, player) {
    if (ageValue == "ALL") return true
    if (Number(ageValue) > Number(player.age)) return true
    else return false
  }
  function clubControl(clubValue, player) {
    if (clubValue == "") return true
    if (player.club.includes(clubValue.toUpperCase())) return true
    else return false
  }
  function nameControl(nameValue, player) {
    if (nameValue == "") return true
    if (player.name.includes(nameValue.toUpperCase())) return true
    else return false
  }

  function fillTable() {
    getE("tableContents").innerHTML = "";
    let count=0;
    playersOnTable.forEach(p => {
      if(count<=14){
      getE("tableContents").innerHTML += (
        "<tr>" + "<th>" + p.id + "</th>" + "<td>" + p.name + "</td>" + "<td>" + p.rat + "</td>" + "<td>" + p.pos + "</td>" + "<td>" + p.nat + "</td>" + "<td>" + p.age + "</td>" + "<td>" + p.club + "</td>" + "<td><button onclick=addplayer(" + p.id + ")>+</button></td>" + "</tr>"
      )
    count++;
    }
    });
  getE("showCount").innerText="Showing "+count+" of "+playersOnTable.length
  }
  function addplayer(id) {
    let tid=id;
    if (playersOnTeam.length < 11) {
      let p = playerMap.get(tid.toString())
      if(isPosFull(p.pos)==false &&  (playersOnTeam.includes(p)==false) ){
        playersOnTeam.push(p);
        makeTeamList();
        getE("teamMes").innerHTML="Team:"
        calcOvrAndChem();
      }
     
    }
    
  }
  function formEdit() {
    // formasyon option üzerinden degisince tetiklenecek
    // listedeki pozisyon adları formasyona göre belirleniyor:
    let yourFormation = document.getElementById("optFor").value.split("-")
    let defNumber=Number(yourFormation[0]);
    let midNumber=Number(yourFormation[1]);
    let fvNumber=Number(yourFormation[2]);
    let x=1;
    for(x;x<11;x++){
      if(x<=defNumber){
        getE("pos"+x.toString()).innerText="DEF"
      }else if(x>defNumber && x<=(defNumber+midNumber)){
        getE("pos"+x.toString()).innerText="MID"
      }else if(x>(defNumber+midNumber) && x<=(defNumber+midNumber+fvNumber)){
        getE("pos"+x.toString()).innerText="FV"
      }
      }
     

    let yedekArr=playersOnTeam
    playersOnTeam=[]
    // Formasyon değiştikten sonra pozisyonda fazla oyuncu kaldıysa birini atıyor.
    yedekArr.forEach(y => {
     addplayer(y.id);
    });
    makeTeamList();
    getE("teamMes").innerHTML="Team: Team organized according to formation."
    getImg();

    calcOvrAndChem();
    giveColortoPos();
  }
  function isPosFull(ppos) {
    // ekleme anında kullanılacak;formasyondaki pozisyon sayı limiti kontrolü
    let limit = 1;
    let yourFormation = document.getElementById("optFor").value.split("-")

    if (ppos == "GK") limit = 1;
    if (ppos == "DEF") limit = yourFormation[0];
    if (ppos == "MID") limit = yourFormation[1];
    if (ppos == "FV") limit = yourFormation[2];

    playersOnTeam.forEach(p => {
      if (p.pos == ppos) { limit--; }
    });

    if (limit == 0) {
      getE("teamMes").innerHTML="Team: Position is full."
      return true
    } else {
      return false;
    }

  }

  function makeTeamList(){
    // isimleri temizleme   
    for(let t=0;t<11;t++)getE("name"+t.toString()).innerText=""

    // oyuncuların listelenmesi

     playersOnTeam.forEach(p => {
      let i=0;
      
        for(i=0;i<11;i++){
          if(p.pos==(getE("pos"+i.toString()).innerText) && getE("name"+i.toString()).innerText==""){
             putToList(p,i);          
             return;
          }   
          
       }
       
    });

    
  }

  function putToList(p,index){
    // name(i) 'nin icerigini degistirme
    getE("name"+index.toString()).innerText=p.name;
  }

  function deletePlayer(id){
   // X ' dan gelen ismi listeden çıkartıyoruz.

   let inText=getE(id).innerText;
   if(inText!=""){

   let delindex=0;
   for (let p of playersOnTeam) {
    if(p.name == getE(id).innerText){
       /// playersOnTeam.pop(p);
        delindex=playersOnTeam.indexOf(p);
        break;
        }
   }
   
        playersOnTeam.splice(delindex, 1);
        makeTeamList();
        calcOvrAndChem();
  }
  }

  function getImg(){
    let url=""
    url='https://furkangundogan.github.io/dataforproject/datafile/formations/';
    getE("forimg").src=url+getE("optFor").value.toString()+'.png'
  }

  function calcOvrAndChem(){
    let totalOvr=0;
    for (let p of playersOnTeam) {
      totalOvr+=Number(p.rat)

    }
    // takim overall degerine gore renk
    getE("ovr").innerText=((totalOvr/11).toFixed(0))
    
    if((totalOvr/11)>65 && (totalOvr/11)<80){
      getE("ovr").style.color="#41b9ff"
    }else if((totalOvr/11)>=80){
      getE("ovr").style.color="#00ff00"
     }else{getE("ovr").style.color="#fff"}


    let chem=0;
    for(let i=0;i<playersOnTeam.length-1;i++){
      for(let j=i+1;j<playersOnTeam.length;j++){
          if(playersOnTeam[i].nat==playersOnTeam[j].nat)chem+=5
          if(playersOnTeam[i].club==playersOnTeam[j].club)chem+=5
    }
    }
    if(chem>99)chem=99;

    // takım kimyasina göre renk
    if(chem>65 && chem<80){
      getE("chem").style.color="#41b9ff"
    }else if(chem>=80){
      getE("chem").style.color="#00ff00"
     }else{
      getE("chem").style.color="#fff"
     }
    

    getE("chem").innerText=chem



  }
   function giveColortoPos(){
    for (let index = 0; index < 11; index++) {
     let x=index;
       let e= getE("pos"+x.toString())
       if(e.innerText=="GK")e.style.color="#7d5100";
       if(e.innerText=="DEF")e.style.color="#000090";
       if(e.innerText=="MID")e.style.color="##095d04";
       if(e.innerText=="FV")e.style.color="#9e0e0e";

    }
    
  }

  function setmargintop(){
    if(innerWidth<500)getE("teamMes").style.marginTop="54%";
    
  }
  function tabletoggle (){
    let e=getE("hideshow");
    if(e.innerText=="Hide Table"){
      getE("tableContents").style.display="none";
      e.innerText="Show Table";
      return
    }else if(e.innerText=="Show Table"){
      getE("tableContents").style.display="table-row-group";
      e.innerText="Hide Table";
    }

  }

  

  getPlayers();
</script>

</html>